<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title> ç¥æˆ‘çš„å°ğŸ…æ–°å¹´å¿«ä¹ï¼ ~ ğŸ†</title>
    <link type="text/css" rel="stylesheet" href="./musicplay.css"  />
    </head>
    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        
      }

      body {
        background-color: #111;
      }

      .fireworks-canvas, .word-container {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
      }

      .word-container {
        display: flex;
        justify-content: center;
        align-items: center;
        pointer-events: none;
      }

      .word-canvas {
        will-change: transform;
      }

      /* .lunbo{
				width:300px;
				height:400px;
				background-image: url(./pics/1.jpg);
        background-size: auto;
        background-position-x: center;
        background-size:100% 100%; 
        /* z-index: 99; */
			} */
    </style>
  </head>

  <body>
    <!-- <div class="lunbo">
			
		</div>
		<script type="text/javascript">
		  var index = 1;
			function lunbo(){
				index ++ ;
				//åˆ¤æ–­numberæ˜¯å¦å¤§äº3
				if(index > 3){
					index = 1;
				}
				//è·å–imgå¯¹è±¡
		var img = document.getElementsByClassName("lunbo")[0];
		img.style.background = "url(./pics/"+index+".jpg)";
		img.style.backgroundSize="100% 100%";	
			}
			//2.å®šä¹‰å®šæ—¶å™¨
			setInterval(lunbo,3000); -->

		</script>

    <canvas id="fireworks" class="fireworks-canvas"></canvas>
    <div class="word-container">
      <canvas id="word" class="word-canvas"></canvas>
    </div>
    <div class="div">
      <center> 
      <img src="./pics/7.jpg" alt="å›¾ç‰‡" class="img" style="width: 300px; height: 400px;"><br/>
      <!-- è¿™é‡Œä¿®æ”¹æ’­æ”¾å™¨æ’­æ”¾éŸ³ä¹ -->
      <!-- è¿™é‡Œé¢çš„autoplay="autoplay"å±æ€§ä¸ºè‡ªåŠ¨æ’­æ”¾ï¼Œä¸æƒ³è®©è‡ªåŠ¨æ’­æ”¾åˆ å»å³å¯ -->
      <audio src="./Green Day - Last Night On Earth.mp3" controls></audio></center>
      <!-- æ­Œè¯æ˜¾ç¤ºç›’å­ -->
      <div class="bg"></div>
      <!-- å¼•å…¥jqueryå’Œ æœ¬åœ° jquery-->
      <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
      <script src="js/jquery-1.9.1.min.js"></script>
      <script src="js/getLyric.js" type="text/javascript"></script>
   <script type="text/javascript">
    $(function() {
        function parseLyric(text) {
            //æŒ‰è¡Œåˆ†å‰²æ­Œè¯
            let lyricArr = text.split('\n');
            //console.log(lyricArr)//0: "[ti:ä¸ƒé‡Œé¦™]" "[ar:å‘¨æ°ä¼¦]"...
            let result = []; //æ–°å»ºä¸€ä¸ªæ•°ç»„å­˜æ”¾æœ€åç»“æœ
            //éå†åˆ†å‰²åçš„æ­Œè¯æ•°ç»„ï¼Œå°†æ ¼å¼åŒ–åçš„æ—¶é—´èŠ‚ç‚¹ï¼Œæ­Œè¯å¡«å……åˆ°resultæ•°ç»„
            for (i = 0; i < lyricArr.length; i++) {
                let playTimeArr = lyricArr[i].match(/\[\d{2}:\d{2}((\.|\:)\d{2})\]/g); //æ­£åˆ™åŒ¹é…æ’­æ”¾æ—¶é—´
                let lineLyric = "";
                if (lyricArr[i].split(playTimeArr).length > 0) {
                    lineLyric = lyricArr[i].split(playTimeArr);
                }

                if (playTimeArr != null) {
                    for (let j = 0; j < playTimeArr.length; j++) {
                        let time = playTimeArr[j].substring(1, playTimeArr[j].indexOf("]")).split(":");
                        //æ•°ç»„å¡«å……
                        result.push({
                            time: (parseInt(time[0]) * 60 + parseFloat(time[1])).toFixed(4),
                            content: String(lineLyric).substr(1)
                        });
                    }
                }


            }
            return result;
        }
        
        // let text = "[00:00.000]ä½œè¯:Armstrong,Billie Joe\n[00:01.000] ä½œæ›² : Wright III, Frank Edwin / Pritchard, Mike Ryan / Armstrong, Billie Joe\n[00:16.290]I text a postcard, sent to you[00:21.100]Did it go through?\n[00:25.110]Sending all my love to you.\n[00:32.750]You are the moonlight of my life every night\n[00:41.340]Giving all my love to you\n[00:48.790]My beating heart belongs to you\n[00:56.670]I walked for miles til I found you\n[01:04.800]I'm here to honor you\n[01:08.340]If I lose everything in the fire\n[01:13.600]I'm sending all my love to you\n[01:32.780]With every breath that I am worth\n[01:37.250]Here on earth\n[01:40.850]I'm sending all my love to you\n[01:48.530]So if you dare to second guess\n[01:53.220]You can rest\n[01:57.300]Assured that all my love's for you\n[02:04.840]My beating heart belongs to you\n[02:12.760]I walked for miles til I found you\n[02:20.740]I'm here to honor you\n[02:24.360]If I lose everything in the fire\n[02:29.590]I'm sending all my love to you\n[03:04.830]My beating heart belongs to you\n[03:12.730]I walked for miles til I found you\n[03:20.740]I'm here to honor you\n[03:24.210]If I lose everything in the fire\n[03:29.750]Did I ever make it through?\n[03:39.750]";
        // let url = 'lyrics/Last Night On Earth - Green Day.lrc';
        // let text = gettxt(url);
        let text = "[00:00.00]ä½œè¯:Armstrong,Billie Joe\n[00:02.00]ä½œæ›²ï¼šWright III, Frank Edwin / Pritchard Mike Ryan\n[00:04.00]Armstrong, Billie Joe\n[00:08.00]æ¼”å”±ï¼šthe Green Day\n[00:16.29]I text a postcard, sent to you\n[00:21.10]Did it go through?\n[00:25.11]Sending all my love to you.\n[00:32.75]You are the moonlight of my life every night\n[00:41.34]Giving all my love to you\n[00:48.79]My beating heart belongs to you\n[00:56.67]I walked for miles til I found you\n[01:04.80]I'm here to honor you\n[01:08.34]If I lose everything in the fire\n[01:13.60]I'm sending all my love to you\n[01:32.78]With every breath that I am worth\n[01:37.25]Here on earth\n[01:40.85]I'm sending all my love to you\n[01:48.53]So if you dare to second guess\n[01:53.22]You can rest\n[01:57.30]Assured that all my love's for you\n[02:04.84]My beating heart belongs to you\n[02:12.76]I walked for miles til I found you\n[02:20.74]I'm here to honor you\n[02:24.36]If I lose everything in the fire\n[02:29.59]I'm sending all my love to you\n[03:04.83]My beating heart belongs to you\n[03:12.73]I walked for miles til I found you\n[03:20.74]I'm here to honor you\n[03:24.21]If I lose everything in the fire\n[03:29.75]Did I ever make it through?\n";

        let audio = document.querySelector('audio');

        let result = parseLyric(text); 

        let $ul = $("<ul></ul>");
        for (let i = 0; i < result.length; i++) {
            let $li = $("<li></li>").text(result[i].content);
            $ul.append($li);
        }
        $(".bg").append($ul);
		// å½“å‰è¡Œæ­Œè¯
        let lineNo = 0; 
		// å½“æ’­æ”¾6è¡Œåå¼€å§‹æ»šåŠ¨æ­Œè¯
        let preLine =1; 
		// æ¯æ¬¡æ»šåŠ¨çš„è·ç¦»
        let lineHeight = -30; 

        // æ»šåŠ¨æ’­æ”¾ æ­Œè¯é«˜äº®  å¢åŠ ç±»åactive
        function highLight() {
            let $li = $("li");
            $li.eq(lineNo).addClass("active").siblings().removeClass("active");
            if (lineNo > preLine) {
                $ul.stop(true, true).animate({ top: (lineNo - preLine) * lineHeight });
            }
        }

        highLight();

        // æ’­æ”¾çš„æ—¶å€™ä¸æ–­æ¸²æŸ“
        audio.addEventListener("timeupdate", function() {
            if (lineNo == result.length) return;
            if ($("li").eq(0).hasClass("active")) {
                $("ul").css("top", "0");
            }
            lineNo =getLineNo(audio.currentTime);
            highLight();
            lineNo++;
        });

        // å½“å¿«è¿›æˆ–è€…å€’é€€çš„æ—¶å€™ï¼Œæ‰¾åˆ°æœ€è¿‘çš„åé¢é‚£ä¸ªresult[i].time
        function getLineNo(currentTime) {
            if (currentTime >= parseFloat(result[lineNo].time)) {
                // å¿«è¿›
                for (let i = result.length - 1; i >= lineNo; i--) {
                    if (currentTime >= parseFloat(result[i].time)) {
                        return i;
                    }
                }
            } else {
                // åé€€
                for (let i = 0; i <= lineNo; i++) {
                    if (currentTime <= parseFloat(result[i].time)) {
                        return i - 1;
                    }
                }
            }
        }

        //æ’­æ”¾ç»“æŸè‡ªåŠ¨å›åˆ°å¼€å¤´
        audio.addEventListener("ended", function() {
            lineNo = 0;
            highLight();
            audio.play();
            $("ul").css("top", "0");
        });
    });
    </script>
</div>
       

    <script src="./js/constants.js"></script>
    <script src="./js/utils.js"></script>
    <script src="./js/imageSrc.js"></script>
    <script src="./js/tinycolor.js"></script>
    <script src="./js/fireworks.js"></script>
    <script src="./js/word.js"></script>

    <script>
      {
        const dom = document.querySelector('#fireworks')
        const options = {}

        const fireworks = new Fireworks(dom, options)
        fireworks.start()

        dom.addEventListener('click', (event) => {
          fireworks.createFirework(event.offsetX, event.offsetY)
        })
      }
      
      {
        const dom = document.querySelector('#word')
        const image = imageSrc
        const word = new Word(dom, image)
        word.start()
      }
      
    </script>
    
  </body>
  
</html>
